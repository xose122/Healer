<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elara - Halfling Healer</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --parchment: #f4ece1;
            --parchment-dark: #e8dcc8;
            --ink: #2a1f1a;
            --ink-light: #4a3f3a;
            --gold: #c9a227;
            --gold-dark: #8b6914;
            --emerald: #2d5a45;
            --emerald-light: #3d7a5a;
            --ruby: #8b2942;
            --purple: #5a3d6a;
            --border-ornate: #6b5344;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Text', Georgia, serif;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(201, 162, 39, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(45, 90, 69, 0.08) 0%, transparent 50%),
                linear-gradient(180deg, #e8dcc8 0%, #f4ece1 50%, #e8dcc8 100%);
            min-height: 100vh;
            color: var(--ink);
            padding: 20px;
        }

        /* Spell Popup Overlay */
        .spell-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(42, 31, 26, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(3px);
        }

        .spell-overlay.active {
            display: flex;
        }

        .spell-popup {
            background: 
                url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E"),
                var(--parchment);
            border: 3px solid var(--gold);
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 
                0 0 0 1px var(--gold-dark),
                0 10px 40px rgba(0,0,0,0.5);
            animation: popupIn 0.2s ease-out;
        }

        @keyframes popupIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .spell-popup-header {
            background: linear-gradient(135deg, var(--ruby) 0%, #ab4962 100%);
            padding: 15px 20px;
            border-bottom: 2px solid var(--gold);
            position: relative;
        }

        .spell-popup-header.cantrip {
            background: linear-gradient(135deg, var(--ink-light) 0%, #5a4f4a 100%);
        }

        .spell-popup-header.subclass {
            background: linear-gradient(135deg, var(--purple) 0%, #7a5d8a 100%);
        }

        .spell-popup-header.moh {
            background: linear-gradient(135deg, var(--emerald) 0%, var(--emerald-light) 100%);
        }

        .spell-popup-title {
            font-family: 'Cinzel', serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 4px;
        }

        .spell-popup-subtitle {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.8);
            font-style: italic;
        }

        .spell-popup-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .spell-popup-close:hover {
            opacity: 1;
        }

        .spell-popup-body {
            padding: 20px;
        }

        .spell-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--gold);
        }

        .spell-meta-item {
            font-size: 0.9rem;
        }

        .spell-meta-label {
            font-weight: 600;
            color: var(--ink-light);
        }

        .spell-description {
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .spell-description p {
            margin-bottom: 10px;
        }

        .spell-description p:last-child {
            margin-bottom: 0;
        }

        .spell-upcast {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--gold);
            font-size: 0.9rem;
            color: var(--ink-light);
        }

        .spell-upcast strong {
            color: var(--ruby);
        }

        /* Clickable spells */
        .spell-link {
            cursor: pointer;
            border-bottom: 1px dotted var(--ink-light);
            transition: all 0.2s;
        }

        .spell-link:hover {
            color: var(--ruby);
            border-bottom-color: var(--ruby);
        }

        /* Dice Roll Toast */
        .dice-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: var(--parchment);
            border: 3px solid var(--gold);
            border-radius: 12px;
            padding: 25px 35px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            z-index: 2000;
            text-align: center;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .dice-toast.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .dice-toast.crit {
            border-color: var(--emerald);
            background: linear-gradient(135deg, rgba(45, 90, 69, 0.15) 0%, var(--parchment) 100%);
        }

        .dice-toast.fail {
            border-color: var(--ruby);
            background: linear-gradient(135deg, rgba(139, 41, 66, 0.15) 0%, var(--parchment) 100%);
        }

        .dice-toast-skill {
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            color: var(--ink-light);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 8px;
        }

        .dice-toast-result {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            font-weight: 700;
            color: var(--ink);
            line-height: 1;
        }

        .dice-toast.crit .dice-toast-result {
            color: var(--emerald);
        }

        .dice-toast.fail .dice-toast-result {
            color: var(--ruby);
        }

        .dice-toast-breakdown {
            font-size: 0.9rem;
            color: var(--ink-light);
            margin-top: 8px;
        }

        .dice-toast-label {
            font-family: 'Cinzel', serif;
            font-size: 0.8rem;
            color: var(--gold-dark);
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sheet {
            max-width: 900px;
            margin: 0 auto;
            background: 
                url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E"),
                var(--parchment);
            border: 3px solid var(--border-ornate);
            border-radius: 4px;
            box-shadow: 
                0 0 0 1px var(--gold-dark),
                0 4px 20px rgba(42, 31, 26, 0.3),
                inset 0 0 60px rgba(42, 31, 26, 0.05);
            padding: 30px;
            position: relative;
        }

        .sheet::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border: 1px solid var(--gold);
            border-radius: 2px;
            pointer-events: none;
            opacity: 0.5;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gold);
            position: relative;
        }

        .header::after {
            content: '‚ùß';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--parchment);
            padding: 0 15px;
            color: var(--gold-dark);
            font-size: 18px;
        }

        .character-name {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            font-weight: 700;
            color: var(--ink);
            text-shadow: 2px 2px 0 var(--parchment-dark);
            letter-spacing: 0.15em;
            margin-bottom: 5px;
        }

        .character-subtitle {
            font-size: 1.2rem;
            font-style: italic;
            color: var(--ink-light);
            letter-spacing: 0.05em;
        }

        /* Combat Stats Row */
        .combat-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .combat-stat {
            background: linear-gradient(135deg, var(--emerald) 0%, var(--emerald-light) 100%);
            border: 2px solid var(--gold-dark);
            border-radius: 8px;
            padding: 12px 8px;
            text-align: center;
            box-shadow: 
                inset 0 1px 0 rgba(255,255,255,0.1),
                0 3px 8px rgba(0,0,0,0.2);
        }

        .combat-stat-label {
            font-family: 'Cinzel', serif;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 4px;
        }

        .combat-stat-value {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .combat-stat-note {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.7);
            font-style: italic;
        }

        .combat-stat.initiative-roll {
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .combat-stat.initiative-roll:hover {
            transform: translateY(-2px);
            box-shadow: 
                inset 0 1px 0 rgba(255,255,255,0.2),
                0 5px 12px rgba(0,0,0,0.3);
        }

        /* Ability Scores */
        .abilities-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--emerald);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: 12px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--gold);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before,
        .section-title::after {
            content: '‚óÜ';
            font-size: 0.6rem;
            color: var(--gold);
        }

        .abilities-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }

        .ability-box {
            background: var(--parchment-dark);
            border: 2px solid var(--border-ornate);
            border-radius: 8px;
            padding: 10px 5px;
            text-align: center;
            position: relative;
        }

        .ability-box.prof {
            border-color: var(--emerald);
            background: linear-gradient(135deg, rgba(45, 90, 69, 0.1) 0%, var(--parchment-dark) 100%);
        }

        .ability-name {
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--ink-light);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .ability-score {
            font-family: 'Cinzel', serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--ink);
        }

        .ability-mod {
            font-size: 1rem;
            font-weight: 600;
            color: var(--emerald);
        }

        .ability-separator {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-ornate), transparent);
            margin: 8px 5px;
        }

        .ability-save {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--ink);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: inline-block;
        }

        .ability-save:hover {
            background: var(--parchment);
            color: var(--ruby);
            transform: scale(1.1);
        }

        .ability-box.prof .ability-save {
            color: var(--emerald);
        }

        .ability-box.prof .ability-save:hover {
            color: var(--ruby);
        }

        .ability-save.conc {
            color: var(--gold-dark);
        }

        .ability-save-dual {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
        }

        .ability-save-divider {
            color: var(--border-ornate);
            font-weight: 300;
        }

        .ability-save-labels {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 0.6rem;
            color: var(--ink-light);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 2px;
        }

        /* Skills Section */
        .skills-section {
            margin-bottom: 25px;
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .skill-item {
            display: flex;
            align-items: center;
            background: var(--parchment-dark);
            border: 1px solid var(--border-ornate);
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 0.85rem;
            min-width: 0;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .skill-item:hover {
            background: var(--parchment);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .skill-item:active {
            transform: translateY(0);
        }

        .skill-item.prof {
            background: linear-gradient(135deg, rgba(45, 90, 69, 0.15) 0%, rgba(45, 90, 69, 0.05) 100%);
            border-color: var(--emerald);
        }

        .skill-ability {
            font-family: 'Cinzel', serif;
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--ink-light);
            text-transform: uppercase;
            width: 28px;
            flex-shrink: 0;
        }

        .skill-name {
            flex: 1;
            color: var(--ink);
        }

        .skill-item.prof .skill-name {
            font-weight: 600;
            color: var(--emerald);
        }

        .skill-bonus {
            font-family: 'Cinzel', serif;
            font-weight: 600;
            color: var(--ink);
            min-width: 35px;
            text-align: right;
        }

        .skill-item.prof .skill-bonus {
            color: var(--emerald);
        }

        .skill-item.expert {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.2) 0%, rgba(201, 162, 39, 0.08) 100%);
            border-color: var(--gold);
            border-width: 2px;
        }

        .skill-item.expert .skill-name {
            color: var(--gold-dark);
        }

        .skill-item.expert .skill-bonus {
            color: var(--gold-dark);
        }

        /* Two Column Layout */
        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .info-box {
            background: var(--parchment-dark);
            border: 1px solid var(--border-ornate);
            border-radius: 6px;
            padding: 15px;
        }

        .info-box h3 {
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--emerald);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px dashed var(--gold);
        }

        .info-box ul {
            list-style: none;
        }

        .info-box li {
            padding: 4px 0;
            padding-left: 18px;
            position: relative;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .info-box li::before {
            content: '‚Ä¢';
            position: absolute;
            left: 0;
            color: var(--gold-dark);
        }

        /* Rest Buttons */
        .rest-box {
            padding-bottom: 15px;
        }

        .rest-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .rest-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            border: 2px solid var(--border-ornate);
            border-radius: 8px;
            background: var(--parchment);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .rest-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .rest-btn:active {
            transform: translateY(0);
        }

        .rest-btn.short-rest {
            border-color: var(--gold);
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.1) 0%, var(--parchment) 100%);
        }

        .rest-btn.short-rest:hover {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.2) 0%, var(--parchment) 100%);
        }

        .rest-btn.long-rest {
            border-color: var(--purple);
            background: linear-gradient(135deg, rgba(90, 61, 106, 0.1) 0%, var(--parchment) 100%);
        }

        .rest-btn.long-rest:hover {
            background: linear-gradient(135deg, rgba(90, 61, 106, 0.2) 0%, var(--parchment) 100%);
        }

        .rest-icon {
            font-size: 1.5rem;
        }

        .rest-label {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--ink);
        }

        .rest-desc {
            font-size: 0.75rem;
            color: var(--ink-light);
            margin-left: auto;
        }

        .save-prof {
            color: var(--emerald);
            font-weight: 600;
        }

        /* Features Section */
        .features-section {
            margin-bottom: 25px;
        }

        .feature-category {
            background: var(--parchment-dark);
            border: 1px solid var(--border-ornate);
            border-radius: 6px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .feature-category-header {
            background: linear-gradient(135deg, var(--emerald) 0%, var(--emerald-light) 100%);
            padding: 10px 15px;
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            font-weight: 600;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .feature-category-header.purple {
            background: linear-gradient(135deg, var(--purple) 0%, #7a5d8a 100%);
        }

        .feature-category-header.ruby {
            background: linear-gradient(135deg, var(--ruby) 0%, #ab4962 100%);
        }

        .feature-category-content {
            padding: 12px 15px;
        }

        .feature-item {
            margin-bottom: 8px;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .feature-item:last-child {
            margin-bottom: 0;
        }

        .feature-name {
            font-weight: 600;
            color: var(--ink);
        }

        .feature-sub {
            margin-left: 20px;
            color: var(--ink-light);
            font-size: 0.85rem;
        }

        /* Spellcasting Section */
        .spellcasting-header {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .spell-stat {
            background: linear-gradient(135deg, var(--ruby) 0%, #ab4962 100%);
            border: 2px solid var(--gold-dark);
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }

        .spell-stat-label {
            font-family: 'Cinzel', serif;
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .spell-stat-value {
            font-family: 'Cinzel', serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
        }

        /* Spell Slots */
        .slots-section {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .slot-box {
            background: var(--parchment-dark);
            border: 1px solid var(--border-ornate);
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }

        .slot-box.healer-dice {
            background: linear-gradient(135deg, var(--emerald) 0%, var(--emerald-light) 100%);
            border-color: var(--gold-dark);
        }

        .slot-label {
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--ink-light);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .slot-box.healer-dice .slot-label {
            color: var(--gold);
        }

        .slot-checkboxes {
            display: flex;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .slot-checkbox {
            width: 22px;
            height: 22px;
            appearance: none;
            border: 2px solid var(--border-ornate);
            border-radius: 50%;
            background: var(--parchment);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .slot-checkbox:checked {
            background: var(--ruby);
            border-color: var(--gold-dark);
            box-shadow: inset 0 0 4px rgba(0,0,0,0.3);
        }

        .slot-box.healer-dice .slot-checkbox:checked {
            background: var(--gold);
        }

        .slot-note {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.8);
            margin-top: 5px;
            font-style: italic;
        }

        /* Spell Lists */
        .spell-level {
            background: var(--parchment-dark);
            border: 1px solid var(--border-ornate);
            border-radius: 6px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .spell-level-header {
            background: var(--ruby);
            padding: 8px 12px;
            font-family: 'Cinzel', serif;
            font-size: 0.8rem;
            font-weight: 600;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .spell-level-content {
            padding: 10px 12px;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .spell-tag {
            font-size: 0.75rem;
            padding: 1px 5px;
            border-radius: 3px;
            margin-left: 2px;
            font-style: normal;
        }

        .spell-tag.subclass {
            background: var(--purple);
            color: #fff;
        }

        .spell-tag.moh {
            background: var(--emerald);
            color: #fff;
        }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.15) 0%, rgba(201, 162, 39, 0.05) 100%);
            border: 2px solid var(--gold);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .quick-ref h3 {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--gold-dark);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 10px;
            text-align: center;
        }

        .buff-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .buff-option {
            background: var(--parchment);
            border: 1px solid var(--gold);
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }

        .buff-option-name {
            font-family: 'Cinzel', serif;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--emerald);
            margin-bottom: 5px;
        }

        .buff-option-effect {
            font-size: 0.85rem;
            color: var(--ink);
        }

        /* Footer */
        .sheet-footer {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid var(--gold);
            text-align: center;
            font-size: 0.8rem;
            color: var(--ink-light);
            font-style: italic;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .combat-row {
                grid-template-columns: repeat(2, 1fr);
            }
            .abilities-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .skills-grid {
                grid-template-columns: 1fr 1fr;
                gap: 4px;
            }
            .skill-item {
                padding: 5px 6px;
                font-size: 0.8rem;
            }
            .skill-ability {
                font-size: 0.55rem;
                width: 24px;
            }
            .skill-name {
                font-size: 0.75rem;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .skill-bonus {
                font-size: 0.8rem;
                min-width: 30px;
            }
            .two-columns {
                grid-template-columns: 1fr;
            }
            .spellcasting-header {
                grid-template-columns: repeat(2, 1fr);
            }
            .slots-section {
                grid-template-columns: repeat(2, 1fr);
            }
            .slot-box.healer-dice {
                grid-column: span 2;
            }
            .buff-options {
                grid-template-columns: 1fr;
            }
            .ability-save-labels {
                gap: 12px;
                font-size: 0.55rem;
            }
        }
        
        @media (max-width: 400px) {
            .skills-grid {
                grid-template-columns: 1fr;
            }
            .abilities-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .sheet {
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>
<body>
    <div class="sheet">
        <!-- Header -->
        <div class="header">
            <h1 class="character-name">ELARA</h1>
            <p class="character-subtitle">Halfling Healer (Vow of the Augmenter) 7 ‚Ä¢ Sage</p>
        </div>

        <!-- Combat Stats -->
        <div class="combat-row">
            <div class="combat-stat">
                <div class="combat-stat-label">Armor Class</div>
                <div class="combat-stat-value">15</div>
                <div class="combat-stat-note">Mage Armor</div>
            </div>
            <div class="combat-stat">
                <div class="combat-stat-label">Hit Points</div>
                <div class="combat-stat-value">65</div>
                <div class="combat-stat-note">d6 + Tough</div>
            </div>
            <div class="combat-stat">
                <div class="combat-stat-label">Speed</div>
                <div class="combat-stat-value">30 ft</div>
                <div class="combat-stat-note">Halfling</div>
            </div>
            <div class="combat-stat initiative-roll" data-bonus="2">
                <div class="combat-stat-label">Initiative</div>
                <div class="combat-stat-value">+2</div>
                <div class="combat-stat-note">DEX (click to roll)</div>
            </div>
        </div>

        <!-- Ability Scores -->
        <div class="abilities-section">
            <h2 class="section-title">Ability Scores</h2>
            <div class="abilities-grid">
                <div class="ability-box">
                    <div class="ability-name">STR</div>
                    <div class="ability-score">10</div>
                    <div class="ability-mod">+0</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save" data-save="Strength" data-bonus="0">+0</div>
                </div>
                <div class="ability-box">
                    <div class="ability-name">DEX</div>
                    <div class="ability-score">14</div>
                    <div class="ability-mod">+2</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save" data-save="Dexterity" data-bonus="2">+2</div>
                </div>
                <div class="ability-box prof">
                    <div class="ability-name">CON</div>
                    <div class="ability-score">16</div>
                    <div class="ability-mod">+3</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save-dual">
                        <div class="ability-save" data-save="Constitution" data-bonus="6">+6</div>
                        <div class="ability-save-divider">|</div>
                        <div class="ability-save conc" data-save="Concentration" data-bonus="11">+11</div>
                    </div>
                    <div class="ability-save-labels">
                        <span>save</span><span>conc</span>
                    </div>
                </div>
                <div class="ability-box prof">
                    <div class="ability-name">INT</div>
                    <div class="ability-score">20</div>
                    <div class="ability-mod">+5</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save" data-save="Intelligence" data-bonus="8">+8</div>
                </div>
                <div class="ability-box prof">
                    <div class="ability-name">WIS</div>
                    <div class="ability-score">12</div>
                    <div class="ability-mod">+1</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save" data-save="Wisdom" data-bonus="4">+4</div>
                </div>
                <div class="ability-box">
                    <div class="ability-name">CHA</div>
                    <div class="ability-score">12</div>
                    <div class="ability-mod">+1</div>
                    <div class="ability-separator"></div>
                    <div class="ability-save" data-save="Charisma" data-bonus="1">+1</div>
                </div>
            </div>
        </div>

        <!-- Proficiencies & Tracker -->
        <div class="two-columns">
            <div class="info-box">
                <h3>Proficiencies</h3>
                <ul>
                    <li><strong>Armor:</strong> Light armor</li>
                    <li><strong>Weapons:</strong> Simple weapons</li>
                    <li><strong>Tools:</strong> Herbalism Kit</li>
                    <li><strong>Languages:</strong> Common, Halfling</li>
                </ul>
            </div>
            <div class="info-box rest-box">
                <h3>Rest</h3>
                <div class="rest-buttons">
                    <button class="rest-btn short-rest" onclick="shortRest()">
                        <span class="rest-icon">‚òÄÔ∏è</span>
                        <span class="rest-label">Short Rest</span>
                        <span class="rest-desc">Recover 5 Healer's Dice</span>
                    </button>
                    <button class="rest-btn long-rest" onclick="longRest()">
                        <span class="rest-icon">üåô</span>
                        <span class="rest-label">Long Rest</span>
                        <span class="rest-desc">Recover all slots & dice</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Skills Section -->
        <div class="skills-section">
            <h2 class="section-title">Skills</h2>
            <div class="skills-grid">
                <div class="skill-item" data-skill="Athletics" data-bonus="0"><span class="skill-ability">STR</span> <span class="skill-name">Athletics</span> <span class="skill-bonus">+0</span></div>
                <div class="skill-item" data-skill="Acrobatics" data-bonus="2"><span class="skill-ability">DEX</span> <span class="skill-name">Acrobatics</span> <span class="skill-bonus">+2</span></div>
                <div class="skill-item" data-skill="Sleight of Hand" data-bonus="2"><span class="skill-ability">DEX</span> <span class="skill-name">Sleight of Hand</span> <span class="skill-bonus">+2</span></div>
                <div class="skill-item" data-skill="Stealth" data-bonus="2"><span class="skill-ability">DEX</span> <span class="skill-name">Stealth</span> <span class="skill-bonus">+2</span></div>
                <div class="skill-item prof" data-skill="Arcana" data-bonus="8"><span class="skill-ability">INT</span> <span class="skill-name">Arcana</span> <span class="skill-bonus">+8 ‚ú¶</span></div>
                <div class="skill-item prof" data-skill="History" data-bonus="8"><span class="skill-ability">INT</span> <span class="skill-name">History</span> <span class="skill-bonus">+8 ‚ú¶</span></div>
                <div class="skill-item" data-skill="Investigation" data-bonus="5"><span class="skill-ability">INT</span> <span class="skill-name">Investigation</span> <span class="skill-bonus">+5</span></div>
                <div class="skill-item prof" data-skill="Nature" data-bonus="8"><span class="skill-ability">INT</span> <span class="skill-name">Nature</span> <span class="skill-bonus">+8 ‚ú¶</span></div>
                <div class="skill-item" data-skill="Religion" data-bonus="5"><span class="skill-ability">INT</span> <span class="skill-name">Religion</span> <span class="skill-bonus">+5</span></div>
                <div class="skill-item" data-skill="Animal Handling" data-bonus="1"><span class="skill-ability">WIS</span> <span class="skill-name">Animal Handling</span> <span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Insight" data-bonus="1"><span class="skill-ability">WIS</span> <span class="skill-name">Insight</span> <span class="skill-bonus">+1</span></div>
                <div class="skill-item prof expert" data-skill="Medicine" data-bonus="9"><span class="skill-ability">WIS</span> <span class="skill-name">Medicine ‚öï</span> <span class="skill-bonus">+9 ‚ú¶</span></div>
                <div class="skill-item" data-skill="Perception" data-bonus="1"><span class="skill-ability">WIS</span> <span class="skill-name">Perception</span> <span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Survival" data-bonus="1"><span class="skill-ability">WIS</span> <span class="skill-name">Survival</span> <span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Deception" data-bonus="1"><span class="skill-ability">CHA</span> <span class="skill-name">Deception</span> <span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Intimidation" data-bonus="1"><span class="skill-ability">CHA</span> <span class="skill-name">Intimidation</span> <span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Performance" data-bonus="1"><span class="skill-ability">CHA</span> <span class="skill-name">Performance</span> <span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Persuasion" data-bonus="1"><span class="skill-ability">CHA</span> <span class="skill-name">Persuasion</span> <span class="skill-bonus">+1</span></div>
            </div>
        </div>

        <!-- Features -->
        <div class="features-section">
            <h2 class="section-title">Features & Traits</h2>
            
            <div class="feature-category">
                <div class="feature-category-header">Halfling Traits</div>
                <div class="feature-category-content">
                    <div class="feature-item"><span class="feature-name">Luck:</span> When you roll a 1 on the d20 of a D20 Test, you can reroll the die, and you must use the new roll</div>
                    <div class="feature-item"><span class="feature-name">Brave:</span> Advantage on saving throws to avoid or end the Frightened condition</div>
                    <div class="feature-item"><span class="feature-name">Halfling Nimbleness:</span> Move through the space of any creature that is a size larger than you, but you can't stop in the same space</div>
                    <div class="feature-item"><span class="feature-name">Naturally Stealthy:</span> You can take the Hide action even when you are obscured only by a creature that is at least one size larger than you</div>
                </div>
            </div>

            <div class="feature-category">
                <div class="feature-category-header">Healer Features (Level 7)</div>
                <div class="feature-category-content">
                    <div class="feature-item"><span class="feature-name">Expert Physician:</span> +5 (INT) to chosen skill check</div>
                    <div class="feature-item"><span class="feature-name">Combat Supporter:</span> +1 to attack rolls and save DCs for ally targeted by lvl 1+ spell (until next turn)</div>
                    <div class="feature-item"><span class="feature-name">Life Tether</span> (60 ft, Bonus Action): Attach magical tether to ally
                        <div class="feature-sub">‚Ä¢ <strong>Healing Tether:</strong> BA to heal tethered ally (or self) by rolling Healer's Dice</div>
                        <div class="feature-sub">‚Ä¢ <strong>Life's Embrace:</strong> Cast spells on tethered creature as if within 5 ft (including Touch)</div>
                        <div class="feature-sub">‚Ä¢ <strong>Healer's Protection:</strong> Reaction to grant Advantage on tethered creature's save</div>
                    </div>
                    <div class="feature-item"><span class="feature-name">Healer's Dice:</span> 14d8 (max 2 at once), regain all on Long Rest</div>
                    <div class="feature-item"><span class="feature-name">Master Healer:</span>
                        <div class="feature-sub">‚Ä¢ <strong>Dice Restoration:</strong> Regain 5 dice on Short Rest</div>
                        <div class="feature-sub">‚Ä¢ <strong>Extra Healing:</strong> Add Healer's Dice to healing spells</div>
                        <div class="feature-sub">‚Ä¢ <strong>Vital Substitution:</strong> Expend dice instead of costly materials (1 die per 50 GP)</div>
                    </div>
                    <div class="feature-item"><span class="feature-name">Restoring Tether:</span> Expend 2 dice to remove Blinded, Deafened, Frightened, or Poisoned</div>
                </div>
            </div>

            <div class="feature-category">
                <div class="feature-category-header purple">Vow of the Augmenter</div>
                <div class="feature-category-content">
                    <div class="feature-item"><span class="feature-name">Enhancing Tether:</span> When using Healing Tether, cast Buff on that ally as part of same BA</div>
                    <div class="feature-item"><span class="feature-name">Combat Augmenter:</span> If spell requires Concentration, Combat Supporter bonus lasts full duration</div>
                    <div class="feature-item"><span class="feature-name">Dual Augmentation</span> (1/Short Rest): Cast 2 Augmenter spells with same action (separate slots, separate targets)</div>
                </div>
            </div>

            <div class="feature-category">
                <div class="feature-category-header ruby">Feat & Background</div>
                <div class="feature-category-content">
                    <div class="feature-item"><span class="feature-name">Tough:</span> +14 HP (2 √ó level)</div>
                    <div class="feature-item"><span class="feature-name">Sage - Researcher:</span> Know where to find information you don't know</div>
                </div>
            </div>
        </div>

        <!-- Spellcasting -->
        <div class="spellcasting-section">
            <h2 class="section-title">Spellcasting</h2>
            
            <div class="spellcasting-header">
                <div class="spell-stat">
                    <div class="spell-stat-label">Spell Save DC</div>
                    <div class="spell-stat-value">17</div>
                </div>
                <div class="spell-stat">
                    <div class="spell-stat-label">Spell Attack</div>
                    <div class="spell-stat-value">+9</div>
                </div>
                <div class="spell-stat">
                    <div class="spell-stat-label">Ability</div>
                    <div class="spell-stat-value">INT</div>
                </div>
                <div class="spell-stat">
                    <div class="spell-stat-label">Focus</div>
                    <div class="spell-stat-value">Arcane</div>
                </div>
            </div>

            <!-- Spell Slots -->
            <div class="slots-section">
                <div class="slot-box">
                    <div class="slot-label">1st Level</div>
                    <div class="slot-checkboxes">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                    </div>
                </div>
                <div class="slot-box">
                    <div class="slot-label">2nd Level</div>
                    <div class="slot-checkboxes">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                    </div>
                </div>
                <div class="slot-box">
                    <div class="slot-label">3rd Level</div>
                    <div class="slot-checkboxes">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                    </div>
                </div>
                <div class="slot-box">
                    <div class="slot-label">4th Level</div>
                    <div class="slot-checkboxes">
                        <input type="checkbox" class="slot-checkbox">
                    </div>
                </div>
                <div class="slot-box healer-dice">
                    <div class="slot-label">Healer's Dice</div>
                    <div class="slot-checkboxes">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                        <input type="checkbox" class="slot-checkbox">
                    </div>
                    <div class="slot-note">Max 2 at once</div>
                </div>
            </div>

            <!-- Spell Lists -->
            <div class="spell-level">
                <div class="spell-level-header">Cantrips</div>
                <div class="spell-level-content">
                    <span class="spell-link" data-spell="buff">Buff</span>, 
                    <span class="spell-link" data-spell="guidance">Guidance</span>, 
                    <span class="spell-link" data-spell="light">Light</span>, 
                    <span class="spell-link" data-spell="spare-the-dying">Spare the Dying</span>
                </div>
            </div>

            <div class="spell-level">
                <div class="spell-level-header">1st Level</div>
                <div class="spell-level-content">
                    <span class="spell-link" data-spell="bless">Bless</span> <span class="spell-tag subclass">SUB</span>, 
                    <span class="spell-link" data-spell="jump">Jump</span> <span class="spell-tag subclass">SUB</span>, 
                    <span class="spell-link" data-spell="healing-word">Healing Word</span> <span class="spell-tag moh">MoH</span>, 
                    <span class="spell-link" data-spell="false-life">False Life</span> <span class="spell-tag moh">MoH</span>, 
                    <span class="spell-link" data-spell="cure-wounds">Cure Wounds</span>, 
                    <span class="spell-link" data-spell="mage-armor">Mage Armor</span>, 
                    <span class="spell-link" data-spell="sanctuary">Sanctuary</span>, 
                    <span class="spell-link" data-spell="shield">Shield</span>
                </div>
            </div>

            <div class="spell-level">
                <div class="spell-level-header">2nd Level</div>
                <div class="spell-level-content">
                    <span class="spell-link" data-spell="enhance-ability">Enhance Ability</span> <span class="spell-tag subclass">SUB</span>, 
                    <span class="spell-link" data-spell="enlarge-reduce">Enlarge/Reduce</span> <span class="spell-tag subclass">SUB</span>, 
                    <span class="spell-link" data-spell="prayer-of-healing">Prayer of Healing</span> <span class="spell-tag moh">MoH</span>, 
                    <span class="spell-link" data-spell="arcane-vigor">Arcane Vigor</span> <span class="spell-tag moh">MoH</span>, 
                    <span class="spell-link" data-spell="regenerating-ward">Regenerating Ward</span>, 
                    <span class="spell-link" data-spell="warding-bond">Warding Bond</span>, 
                    <span class="spell-link" data-spell="lesser-restoration">Lesser Restoration</span>, 
                    <span class="spell-link" data-spell="misty-step">Misty Step</span>
                </div>
            </div>

            <div class="spell-level">
                <div class="spell-level-header">3rd Level</div>
                <div class="spell-level-content">
                    <span class="spell-link" data-spell="fly">Fly</span> <span class="spell-tag subclass">SUB</span>, 
                    <span class="spell-link" data-spell="haste">Haste</span> <span class="spell-tag subclass">SUB</span>, 
                    <span class="spell-link" data-spell="aura-of-vitality">Aura of Vitality</span> <span class="spell-tag moh">MoH</span>, 
                    <span class="spell-link" data-spell="mass-healing-word">Mass Healing Word</span> <span class="spell-tag moh">MoH</span>, 
                    <span class="spell-link" data-spell="beacon-of-hope">Beacon of Hope</span>, 
                    <span class="spell-link" data-spell="synergize">Synergize</span>
                </div>
            </div>

            <div class="spell-level">
                <div class="spell-level-header">4th Level</div>
                <div class="spell-level-content">
                    <span class="spell-link" data-spell="stoneskin">Stoneskin</span> <span class="spell-tag subclass">SUB</span>, 
                    <span class="spell-link" data-spell="unlock-potential">Unlock Potential</span> <span class="spell-tag subclass">SUB</span>, 
                    <span class="spell-link" data-spell="aura-of-life">Aura of Life</span> <span class="spell-tag moh">MoH</span>, 
                    <span class="spell-link" data-spell="aura-of-purity">Aura of Purity</span> <span class="spell-tag moh">MoH</span>, 
                    <span class="spell-link" data-spell="heroic-sacrifice">Heroic Sacrifice</span>
                </div>
            </div>
        </div>

        <!-- Quick Reference: Buff -->
        <div class="quick-ref">
            <h3>‚ö° Quick Reference: Buff (Cantrip)</h3>
            <p style="text-align: center; margin-bottom: 12px; font-size: 0.9rem; color: var(--ink-light);">
                Action ‚Ä¢ 60 ft ‚Ä¢ 1 round ‚Ä¢ Choose one effect on an ally:
            </p>
            <div class="buff-options">
                <div class="buff-option">
                    <div class="buff-option-name">Amplified Attacks</div>
                    <div class="buff-option-effect">Next hit deals <strong>+2d8</strong> damage</div>
                </div>
                <div class="buff-option">
                    <div class="buff-option-name">Fleeting Protection</div>
                    <div class="buff-option-effect">Gain <strong>2d8</strong> Temp HP</div>
                </div>
                <div class="buff-option">
                    <div class="buff-option-name">Speedy Flight</div>
                    <div class="buff-option-effect"><strong>+10 ft</strong> Speed, OAs have DisAdv</div>
                </div>
            </div>
        </div>

        <div class="sheet-footer">
            Healer Class (Homebrew) ‚Ä¢ D&D 5e 2024 ‚Ä¢ Mark of Healing (Eberron)
        </div>
    </div>

    <!-- Dice Roll Toast -->
    <div class="dice-toast" id="diceToast">
        <div class="dice-toast-skill" id="diceSkill">Medicine</div>
        <div class="dice-toast-result" id="diceResult">25</div>
        <div class="dice-toast-breakdown" id="diceBreakdown">üé≤ 16 + 9</div>
        <div class="dice-toast-label" id="diceLabel"></div>
    </div>

    <!-- Spell Popup Overlay -->
    <div class="spell-overlay" id="spellOverlay">
        <div class="spell-popup">
            <div class="spell-popup-header" id="spellHeader">
                <h2 class="spell-popup-title" id="spellTitle">Spell Name</h2>
                <p class="spell-popup-subtitle" id="spellSubtitle">Level X School</p>
                <button class="spell-popup-close" onclick="closeSpellPopup()">√ó</button>
            </div>
            <div class="spell-popup-body">
                <div class="spell-meta" id="spellMeta"></div>
                <div class="spell-description" id="spellDescription"></div>
                <div class="spell-upcast" id="spellUpcast" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        const spells = {
            // Cantrips
            "buff": {
                name: "Buff",
                level: "Cantrip",
                school: "Transmutation",
                type: "cantrip",
                castingTime: "Action",
                range: "60 feet",
                components: "V, S",
                duration: "1 round",
                description: `<p>You briefly enhance the capabilities of one creature other than yourself that you can see within range. Select one of the following enhancements, which lasts until the start of your next turn.</p>
                <p><strong>Amplified Attacks.</strong> The next time the target hits with an attack roll and deals damage, it can add 1d8 to the damage roll.</p>
                <p><strong>Fleeting Protection.</strong> The target gains 1d8 Temporary Hit Points. These Temporary Hit Points vanish if any remain when the spell ends.</p>
                <p><strong>Speedy Flight.</strong> The target's Speed increases by 5 feet and Opportunity Attacks are made against it with Disadvantage.</p>`,
                upcast: "The damage of Amplified Attacks and the Temporary Hit Points of Fleeting Protection increase by 1d8 when you reach levels 5 (2d8), 11 (3d8) and 17 (4d8). The Speed boost of Speedy Flight also increases by 5 feet at levels 5 (10 ft), 11 (15 ft) and 17 (20 ft). <strong>At level 7: 2d8 damage/THP, +10 ft Speed.</strong>"
            },
            "guidance": {
                name: "Guidance",
                level: "Cantrip",
                school: "Divination",
                type: "cantrip",
                castingTime: "Action",
                range: "Touch",
                components: "V, S",
                duration: "Concentration, up to 1 minute",
                description: `<p>You touch a willing creature and choose a skill. Until the spell ends, the creature adds 1d4 to any ability check using the chosen skill.</p>`
            },
            "light": {
                name: "Light",
                level: "Cantrip",
                school: "Evocation",
                type: "cantrip",
                castingTime: "Action",
                range: "Touch",
                components: "V, M (a firefly or phosphorescent moss)",
                duration: "1 hour",
                description: `<p>You touch one object that is no larger than 10 feet in any dimension. Until the spell ends, the object sheds bright light in a 20-foot radius and dim light for an additional 20 feet. The light can be colored as you like. Completely covering the object with something opaque blocks the light. The spell ends if you cast it again or dismiss it as an action.</p>
                <p>If you target an object held or worn by a hostile creature, that creature must succeed on a Dexterity saving throw to avoid the spell.</p>`
            },
            "spare-the-dying": {
                name: "Spare the Dying",
                level: "Cantrip",
                school: "Necromancy",
                type: "cantrip",
                castingTime: "Action",
                range: "15 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: `<p>Choose a creature within range that has 0 Hit Points and isn't dead. The creature becomes Stable.</p>`
            },
            // 1st Level
            "bless": {
                name: "Bless",
                level: "1st",
                school: "Enchantment",
                type: "subclass",
                castingTime: "Action",
                range: "30 feet",
                components: "V, S, M (a sprinkling of holy water)",
                duration: "Concentration, up to 1 minute",
                description: `<p>You bless up to three creatures of your choice within range. Whenever a target makes an attack roll or a saving throw before the spell ends, the target can roll a d4 and add the number rolled to the attack roll or saving throw.</p>`,
                upcast: "You can target one additional creature for each slot level above 1st."
            },
            "jump": {
                name: "Jump",
                level: "1st",
                school: "Transmutation",
                type: "subclass",
                castingTime: "Bonus Action",
                range: "Touch",
                components: "V, S, M (a grasshopper's hind leg)",
                duration: "1 minute",
                description: `<p>You touch a willing creature. Once on each of its turns until the spell ends, that creature can jump up to 30 feet by spending only 10 feet of movement.</p>`,
                upcast: "You can target one additional creature for each slot level above 1st."
            },
            "healing-word": {
                name: "Healing Word",
                level: "1st",
                school: "Abjuration",
                type: "moh",
                castingTime: "Bonus Action",
                range: "60 feet",
                components: "V",
                duration: "Instantaneous",
                description: `<p>A creature of your choice that you can see within range regains hit points equal to 2d4 + your spellcasting ability modifier.</p>`,
                upcast: "The healing increases by 2d4 for each slot level above 1st."
            },
            "false-life": {
                name: "False Life",
                level: "1st",
                school: "Necromancy",
                type: "moh",
                castingTime: "Action",
                range: "Self",
                components: "V, S, M (a small amount of alcohol)",
                duration: "Instantaneous",
                description: `<p>You gain 2d4 + 4 Temporary Hit Points.</p>`,
                upcast: "You gain 5 additional Temporary Hit Points for each slot level above 1st."
            },
            "cure-wounds": {
                name: "Cure Wounds",
                level: "1st",
                school: "Abjuration",
                type: "normal",
                castingTime: "Action",
                range: "Touch",
                components: "V, S",
                duration: "Instantaneous",
                description: `<p>A creature you touch regains a number of hit points equal to 2d8 + your spellcasting ability modifier.</p>`,
                upcast: "The healing increases by 2d8 for each slot level above 1st."
            },
            "mage-armor": {
                name: "Mage Armor",
                level: "1st",
                school: "Abjuration",
                type: "normal",
                castingTime: "Action",
                range: "Touch",
                components: "V, S, M (a piece of cured leather)",
                duration: "8 hours",
                description: `<p>You touch a willing creature who isn't wearing armor. Until the spell ends, the target's base AC becomes 13 + its Dexterity modifier. The spell ends if the target dons armor or if you dismiss the spell as an action.</p>`
            },
            "shield": {
                name: "Shield",
                level: "1st",
                school: "Abjuration",
                type: "normal",
                castingTime: "Reaction, when you are hit by an attack roll or targeted by Magic Missile",
                range: "Self",
                components: "V, S",
                duration: "1 round",
                description: `<p>An invisible barrier of magical force appears and protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from Magic Missile.</p>`
            },
            // 2nd Level
            "enhance-ability": {
                name: "Enhance Ability",
                level: "2nd",
                school: "Transmutation",
                type: "subclass",
                castingTime: "Action",
                range: "Touch",
                components: "V, S, M (fur or a feather)",
                duration: "Concentration, up to 1 hour",
                description: `<p>You touch a creature and choose Strength, Dexterity, Intelligence, Wisdom, or Charisma. For the duration, the target has Advantage on ability checks using the chosen ability.</p>`,
                upcast: "You can target one additional creature for each spell slot level above 2. You can choose a different ability for each target."
            },
            "enlarge-reduce": {
                name: "Enlarge/Reduce",
                level: "2nd",
                school: "Transmutation",
                type: "subclass",
                castingTime: "Action",
                range: "30 feet",
                components: "V, S, M (a pinch of powdered iron)",
                duration: "Concentration, up to 1 minute",
                description: `<p>For the duration, you cause a creature or an object you can see within range to grow larger or smaller.</p>
                <p><strong>Enlarge.</strong> The target's size increases by one category‚Äîfrom Medium to Large, for example. The target also has Advantage on Strength checks and Strength saving throws. The target's attacks with its body or weapons deal 1d4 extra damage.</p>
                <p><strong>Reduce.</strong> The target's size decreases by one category‚Äîfrom Medium to Small, for example. The target also has Disadvantage on Strength checks and Strength saving throws. The target's attacks with its body or weapons deal 1d4 less damage (this can't reduce the damage below 1).</p>`
            },
            "prayer-of-healing": {
                name: "Prayer of Healing",
                level: "2nd",
                school: "Abjuration",
                type: "moh",
                castingTime: "10 minutes",
                range: "30 feet",
                components: "V",
                duration: "Instantaneous",
                description: `<p>Up to five creatures of your choice who remain within range for the spell's entire casting gain the benefits of a Short Rest and also regain 2d8 Hit Points. A creature can't be affected by this spell again until that creature finishes a Long Rest.</p>`,
                upcast: "The healing increases by 1d8 for each spell slot level above 2."
            },
            "arcane-vigor": {
                name: "Arcane Vigor",
                level: "2nd",
                school: "Abjuration",
                type: "moh",
                castingTime: "Bonus Action",
                range: "Self",
                components: "V, S",
                duration: "Instantaneous",
                description: `<p>You tap into your life force to heal yourself. Roll one or two of your unexpended Hit Point Dice, and regain a number of Hit Points equal to the roll's total plus your spellcasting ability modifier. Those dice are then expended.</p>`,
                upcast: "The number of unexpended Hit Dice you can roll increases by one for each spell slot level above 2."
            },
            "regenerating-ward": {
                name: "Regenerating Ward",
                level: "2nd",
                school: "Abjuration",
                type: "normal",
                castingTime: "Action",
                range: "30 feet",
                components: "V, S",
                duration: "Concentration, up to 1 minute",
                description: `<p>You create a regenerating abjurative force field around a single willing creature you can see within range. For the duration, the target gains a +1 bonus to its AC, and at the start of each of its turns, it gains a number of Temporary Hit Points equal to 2 plus your spellcasting ability modifier (7 THP for Elara). These Temporary Hit Points disappear when the spell ends.</p>`,
                upcast: "You can target one additional creature for each slot level above 2."
            },
            "warding-bond": {
                name: "Warding Bond",
                level: "2nd",
                school: "Abjuration",
                type: "normal",
                castingTime: "Action",
                range: "Touch",
                components: "V, S, M (a pair of platinum rings worth 50+ GP each, which you and the target must wear for the duration)",
                duration: "1 hour",
                description: `<p>You touch a willing creature and create a mystic connection between you and the target until the spell ends. While the target is within 60 feet of you, it gains a +1 bonus to AC and saving throws, and it has Resistance to all damage. Also, each time it takes damage, you take the same amount of damage.</p>
                <p>The spell ends if you drop to 0 Hit Points or if you and the target become separated by more than 60 feet. It also ends if the spell is cast again on either of the connected creatures.</p>`
            },
            "lesser-restoration": {
                name: "Lesser Restoration",
                level: "2nd",
                school: "Abjuration",
                type: "normal",
                castingTime: "Bonus Action",
                range: "Touch",
                components: "V, S",
                duration: "Instantaneous",
                description: `<p>You touch a creature and end one condition on it: Blinded, Deafened, Paralyzed, or Poisoned.</p>`
            },
            "misty-step": {
                name: "Misty Step",
                level: "2nd",
                school: "Conjuration",
                type: "normal",
                castingTime: "Bonus Action",
                range: "Self",
                components: "V",
                duration: "Instantaneous",
                description: `<p>Briefly surrounded by silvery mist, you teleport up to 30 feet to an unoccupied space that you can see.</p>`
            },
            // 3rd Level
            "fly": {
                name: "Fly",
                level: "3rd",
                school: "Transmutation",
                type: "subclass",
                castingTime: "Action",
                range: "Touch",
                components: "V, S, M (a wing feather)",
                duration: "Concentration, up to 10 minutes",
                description: `<p>You touch a willing creature. The target gains a flying speed of 60 feet for the duration. When the spell ends, the target falls if it is still aloft, unless it can stop the fall.</p>`,
                upcast: "You can target one additional creature for each slot level above 3rd."
            },
            "haste": {
                name: "Haste",
                level: "3rd",
                school: "Transmutation",
                type: "subclass",
                castingTime: "Action",
                range: "30 feet",
                components: "V, S, M (a shaving of licorice root)",
                duration: "Concentration, up to 1 minute",
                description: `<p>Choose a willing creature that you can see within range. Until the spell ends, the target's speed is doubled, it gains a +2 bonus to AC, it has advantage on Dexterity saving throws, and it gains an additional action on each of its turns. That action can be used only to take the Attack (one weapon attack only), Dash, Disengage, Hide, or Use an Object action.</p>
                <p>When the spell ends, the target can't move or take actions until after its next turn, as a wave of lethargy sweeps over it.</p>`
            },
            "aura-of-vitality": {
                name: "Aura of Vitality",
                level: "3rd",
                school: "Abjuration",
                type: "moh",
                castingTime: "Action",
                range: "Self (30-foot emanation)",
                components: "V",
                duration: "Concentration, up to 1 minute",
                description: `<p>An aura radiates from you in a 30-foot Emanation for the duration. When you create this aura and at the start of each of your turns while it persists, you can restore 2d6 Hit Points to one creature in it.</p>`
            },
            "mass-healing-word": {
                name: "Mass Healing Word",
                level: "3rd",
                school: "Abjuration",
                type: "moh",
                castingTime: "Bonus Action",
                range: "60 feet",
                components: "V",
                duration: "Instantaneous",
                description: `<p>Up to six creatures of your choice that you can see within range regain Hit Points equal to 2d4 + your spellcasting ability modifier.</p>`,
                upcast: "The healing increases by 1d4 for each slot level above 3rd."
            },
            "beacon-of-hope": {
                name: "Beacon of Hope",
                level: "3rd",
                school: "Abjuration",
                type: "normal",
                castingTime: "Action",
                range: "30 feet",
                components: "V, S",
                duration: "Concentration, up to 1 minute",
                description: `<p>Choose any number of creatures within range. For the duration, each target has Advantage on Wisdom saving throws and Death Saving Throws, and regains the maximum number of Hit Points possible from any healing.</p>`
            },
            "synergize": {
                name: "Synergize",
                level: "3rd",
                school: "Transmutation",
                type: "normal",
                castingTime: "Action",
                range: "60 feet",
                components: "V, S",
                duration: "Concentration, up to 1 minute",
                description: `<p>Select two to three willing creatures that you can see within range. For the duration, each target is linked, making it more aware of and capable of helping its fellow linked creatures. Linked creatures gain the following benefits:</p>
                <p>‚Ä¢ Whenever a linked creature fails a D20 Test, another linked creature within 30 feet of it can take a Reaction to allow it to re-roll the test. It must use the new result.</p>
                <p>‚Ä¢ When a linked creature rolls damage for an attack, it can add 1d6 to the damage roll for each other linked creature within 30 feet of it, as those allies contribute to the strike. It can do so only once per turn.</p>`,
                upcast: "You can target one additional creature for each slot level above 3rd."
            },
            // 4th Level
            "stoneskin": {
                name: "Stoneskin",
                level: "4th",
                school: "Transmutation",
                type: "subclass",
                castingTime: "Action",
                range: "Touch",
                components: "V, S, M (diamond dust worth 100+ GP, which the spell consumes)",
                duration: "Concentration, up to 1 hour",
                description: `<p>You touch a willing creature. Until the spell ends, the target has Resistance to Bludgeoning, Piercing, and Slashing damage.</p>`
            },
            "unlock-potential": {
                name: "Unlock Potential",
                level: "4th",
                school: "Transmutation",
                type: "subclass",
                castingTime: "Action",
                range: "Touch",
                components: "V, S",
                duration: "Concentration, up to 1 minute",
                description: `<p>You touch a creature other than yourself and unlock the latent potential within it. Select either Unlocked Spellcasting or Unlocked Attacks. The target gains the benefits for the duration.</p>
                <p><strong>Unlocked Spellcasting.</strong> When the target casts a spell using a spell slot, it can treat the spell as if it was cast with a spell slot of one level higher. Spells cast with a level 5+ spell slot aren't affected.</p>
                <p><strong>Unlocked Attacks.</strong> When the target takes the Attack action, it can make one additional attack as part of that action. In addition, it deals an extra 1d6 Force damage to the target whenever it hits with an attack roll.</p>`,
                upcast: "You can concentrate on the spell for longer: for 10 minutes (level 5-6 slot), for 1 hour (level 7 slot) or for 8 hours (level 8 slot). If you use a level 9 slot, the spell doesn't require Concentration, and its duration becomes 24 hours."
            },
            "aura-of-life": {
                name: "Aura of Life",
                level: "4th",
                school: "Abjuration",
                type: "moh",
                castingTime: "Action",
                range: "Self (30-foot emanation)",
                components: "V",
                duration: "Concentration, up to 10 minutes",
                description: `<p>An aura radiates from you in a 30-foot Emanation for the duration. While in the aura, you and your allies have Resistance to Necrotic damage, and your Hit Point maximums can't be reduced. If an ally with 0 Hit Points starts its turn in the aura, it regains 1 Hit Point.</p>`
            },
            "aura-of-purity": {
                name: "Aura of Purity",
                level: "4th",
                school: "Abjuration",
                type: "moh",
                castingTime: "Action",
                range: "Self (30-foot emanation)",
                components: "V",
                duration: "Concentration, up to 10 minutes",
                description: `<p>An aura radiates from you in a 30-foot Emanation for the duration. While in the aura, you and your allies can't become Diseased, have Resistance to Poison damage, and have Advantage on saves to avoid or end the Blinded, Charmed, Deafened, Frightened, Paralyzed, Poisoned, and Stunned conditions.</p>`
            },
            "sanctuary": {
                name: "Sanctuary",
                level: "1st",
                school: "Abjuration",
                type: "normal",
                castingTime: "Bonus Action",
                range: "30 feet",
                components: "V, S, M (a small silver mirror)",
                duration: "1 minute",
                description: `<p>You ward a creature within range. Until the spell ends, any creature who targets the warded creature with an attack roll or a harmful spell must first make a Wisdom saving throw. On a failed save, the creature must choose a new target or lose the attack or spell. This spell doesn't protect the warded creature from area effects.</p>
                <p>If the warded creature makes an attack roll, casts a spell that affects an enemy, or deals damage to another creature, this spell ends.</p>`
            },
            "heroic-sacrifice": {
                name: "Heroic Sacrifice",
                level: "4th",
                school: "Abjuration",
                type: "normal",
                castingTime: "Reaction, which you take when you see another creature within range fail a saving throw against a spell or magical effect",
                range: "60 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: `<p>You interpose yourself against the triggering magic, causing it to affect you instead of the original target. The triggering creature is no longer affected by the spell or magical effect, and you become its target, even if you would normally be out of its range. You immediately make the required saving throw against the effect, suffering its consequences on a failure. You do not suffer any effects on a successful save.</p>`
            }
        };

        function openSpellPopup(spellId) {
            const spell = spells[spellId];
            if (!spell) return;

            const overlay = document.getElementById('spellOverlay');
            const header = document.getElementById('spellHeader');
            const title = document.getElementById('spellTitle');
            const subtitle = document.getElementById('spellSubtitle');
            const meta = document.getElementById('spellMeta');
            const description = document.getElementById('spellDescription');
            const upcast = document.getElementById('spellUpcast');

            // Set header class based on spell type
            header.className = 'spell-popup-header ' + (spell.type || '');

            title.textContent = spell.name;
            subtitle.textContent = spell.level === 'Cantrip' 
                ? `${spell.school} Cantrip` 
                : `Level ${spell.level} ${spell.school}`;

            meta.innerHTML = `
                <div class="spell-meta-item"><span class="spell-meta-label">Casting Time:</span> ${spell.castingTime}</div>
                <div class="spell-meta-item"><span class="spell-meta-label">Range:</span> ${spell.range}</div>
                <div class="spell-meta-item"><span class="spell-meta-label">Components:</span> ${spell.components}</div>
                <div class="spell-meta-item"><span class="spell-meta-label">Duration:</span> ${spell.duration}</div>
            `;

            description.innerHTML = spell.description;

            if (spell.upcast) {
                upcast.innerHTML = `<strong>Using a Higher-Level Spell Slot:</strong> ${spell.upcast}`;
                upcast.style.display = 'block';
            } else {
                upcast.style.display = 'none';
            }

            overlay.classList.add('active');
        }

        function closeSpellPopup() {
            document.getElementById('spellOverlay').classList.remove('active');
        }

        // Close on overlay click
        document.getElementById('spellOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSpellPopup();
            }
        });

        // Close on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeSpellPopup();
            }
        });

        // Add click handlers to all spell links
        document.querySelectorAll('.spell-link').forEach(link => {
            link.addEventListener('click', function() {
                openSpellPopup(this.dataset.spell);
            });
        });

        // Dice rolling functionality
        let diceToastTimeout = null;

        function rollD20() {
            return Math.floor(Math.random() * 20) + 1;
        }

        function hideDiceToast() {
            const toast = document.getElementById('diceToast');
            toast.classList.remove('show');
            if (diceToastTimeout) {
                clearTimeout(diceToastTimeout);
                diceToastTimeout = null;
            }
        }

        function showDiceRoll(skillName, bonus) {
            const roll = rollD20();
            const total = roll + bonus;
            const toast = document.getElementById('diceToast');
            const skillEl = document.getElementById('diceSkill');
            const resultEl = document.getElementById('diceResult');
            const breakdownEl = document.getElementById('diceBreakdown');
            const labelEl = document.getElementById('diceLabel');

            skillEl.textContent = skillName;
            resultEl.textContent = total;
            breakdownEl.textContent = `üé≤ ${roll} ${bonus >= 0 ? '+' : ''}${bonus}`;

            // Remove previous classes
            toast.classList.remove('crit', 'fail');

            // Check for nat 20 or nat 1
            if (roll === 20) {
                toast.classList.add('crit');
                labelEl.textContent = '¬°Natural 20!';
            } else if (roll === 1) {
                toast.classList.add('fail');
                labelEl.textContent = 'Natural 1...';
            } else {
                labelEl.textContent = '';
            }

            // Clear any existing timeout
            if (diceToastTimeout) {
                clearTimeout(diceToastTimeout);
            }

            // Show toast
            toast.classList.add('show');

            // Hide after delay
            diceToastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // Close dice toast when clicking outside
        document.addEventListener('click', function(e) {
            const toast = document.getElementById('diceToast');
            if (toast.classList.contains('show') && !e.target.closest('.skill-item') && !e.target.closest('.ability-save') && !e.target.closest('.initiative-roll')) {
                hideDiceToast();
            }
        });

        // Add click handlers to all skill items
        document.querySelectorAll('.skill-item').forEach(item => {
            item.addEventListener('click', function() {
                const skill = this.dataset.skill;
                const bonus = parseInt(this.dataset.bonus);
                showDiceRoll(skill, bonus);
            });
        });

        // Add click handlers to all saving throw items (now inside ability boxes)
        document.querySelectorAll('.ability-save').forEach(item => {
            item.addEventListener('click', function(e) {
                e.stopPropagation();
                const save = this.dataset.save;
                const bonus = parseInt(this.dataset.bonus);
                showDiceRoll(save + ' Save', bonus);
            });
        });

        // Add click handler for initiative
        document.querySelector('.initiative-roll').addEventListener('click', function(e) {
            e.stopPropagation();
            const bonus = parseInt(this.dataset.bonus);
            showDiceRoll('Initiative', bonus);
        });

        // Make spell stats clickable for attack rolls
        document.querySelectorAll('.spell-stat').forEach(stat => {
            const label = stat.querySelector('.spell-stat-label');
            if (label && label.textContent.includes('Attack')) {
                stat.style.cursor = 'pointer';
                stat.addEventListener('click', function() {
                    const value = this.querySelector('.spell-stat-value').textContent;
                    const bonus = parseInt(value.replace('+', ''));
                    showDiceRoll('Spell Attack', bonus);
                });
                stat.addEventListener('mouseenter', function() { this.style.transform = 'translateY(-2px)'; this.style.boxShadow = 'inset 0 1px 0 rgba(255,255,255,0.2), 0 5px 12px rgba(0,0,0,0.3)'; });
                stat.addEventListener('mouseleave', function() { this.style.transform = ''; this.style.boxShadow = ''; });
            }
        });

        // Rest functions
        function shortRest() {
            // Recover 5 Healer's Dice (uncheck up to 5)
            const healerDice = document.querySelectorAll('.slot-box.healer-dice .slot-checkbox:checked');
            let recovered = 0;
            healerDice.forEach(checkbox => {
                if (recovered < 5) {
                    checkbox.checked = false;
                    recovered++;
                }
            });
            
            // Save state and show feedback
            saveState();
            showRestToast('Short Rest', `Recovered ${recovered} Healer's Dice`);
        }

        function longRest() {
            // Recover all spell slots
            document.querySelectorAll('.slot-box:not(.healer-dice) .slot-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Recover all Healer's Dice
            document.querySelectorAll('.slot-box.healer-dice .slot-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Save state and show feedback
            saveState();
            showRestToast('Long Rest', 'All slots & dice recovered');
        }

        // LocalStorage functions
        function saveState() {
            const state = {
                spellSlots: [],
                healerDice: []
            };
            
            // Save spell slots
            document.querySelectorAll('.slot-box:not(.healer-dice) .slot-checkbox').forEach((checkbox, index) => {
                state.spellSlots[index] = checkbox.checked;
            });
            
            // Save healer dice
            document.querySelectorAll('.slot-box.healer-dice .slot-checkbox').forEach((checkbox, index) => {
                state.healerDice[index] = checkbox.checked;
            });
            
            localStorage.setItem('elara-character-state', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('elara-character-state');
            if (!saved) return;
            
            try {
                const state = JSON.parse(saved);
                
                // Restore spell slots
                document.querySelectorAll('.slot-box:not(.healer-dice) .slot-checkbox').forEach((checkbox, index) => {
                    if (state.spellSlots && state.spellSlots[index] !== undefined) {
                        checkbox.checked = state.spellSlots[index];
                    }
                });
                
                // Restore healer dice
                document.querySelectorAll('.slot-box.healer-dice .slot-checkbox').forEach((checkbox, index) => {
                    if (state.healerDice && state.healerDice[index] !== undefined) {
                        checkbox.checked = state.healerDice[index];
                    }
                });
            } catch (e) {
                console.error('Error loading saved state:', e);
            }
        }

        // Auto-save when checkboxes change
        document.querySelectorAll('.slot-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', saveState);
        });

        // Load state on page load
        loadState();

        function showRestToast(title, message) {
            const toast = document.getElementById('diceToast');
            const skillEl = document.getElementById('diceSkill');
            const resultEl = document.getElementById('diceResult');
            const breakdownEl = document.getElementById('diceBreakdown');
            const labelEl = document.getElementById('diceLabel');

            skillEl.textContent = title;
            resultEl.textContent = '‚úì';
            breakdownEl.textContent = message;
            labelEl.textContent = '';

            toast.classList.remove('crit', 'fail');
            toast.classList.add('show');

            if (diceToastTimeout) {
                clearTimeout(diceToastTimeout);
            }

            diceToastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }
    </script>
</body>
</html>
